#!/bin/bash

NOTE_FILE="$HOME/.note/-note"
mkdir -p "$(dirname "$NOTE_FILE")"
touch "$NOTE_FILE"

show_help() {
  echo "Usage:"
  echo "  note 'your note'       → Save a note"
  echo "  note -v                → View all notes"
  echo "  note -ln               → View notes with line numbers"
  echo "  note -ad               → Delete ALL notes"
  echo "  note -Nd (e.g., -10d)  → Delete line N"
  echo "  note -s 'keyword'      → Search notes (with line numbers)"
  echo "  note -h                → Show help"
}

case "$1" in
  ""|-h) show_help ;;
  -v)    [[ -s "$NOTE_FILE" ]] && cat "$NOTE_FILE" || echo "No notes yet!" ;;
  -ln)   [[ -s "$NOTE_FILE" ]] && nl -ba "$NOTE_FILE" || echo "No notes yet!" ;;
  -ad)   > "$NOTE_FILE" && echo "All notes deleted!" ;;
  -[0-9]*d)
    line_num="${1//[!0-9]/}"
    [[ -s "$NOTE_FILE" ]] && sed -i "${line_num}d" "$NOTE_FILE" && echo "Deleted line $line_num." || echo "No notes to delete!"
    ;;
  -s)
    if [[ -z "$2" ]]; then
      echo "Error: Search term required."
    else
      echo "Search results (Line:Text):"
      grep -ni "$2" "$NOTE_FILE" || echo "No matches found."
    fi
    ;;
  *)
    echo "$(date +'%Y-%m-%d %H:%M:%S'): $1" >> "$NOTE_FILE"
    echo "Note saved!"
    ;;
esac
